<!doctype html>
<html lang="en" ng-app="detail">
<head>
    <meta charset="UTF-8">
    <title>活动详情</title>
    <meta name="description" content="庖丁科技众包服务平台携手国内外先进技术科研院所、顶级技术专家，以实现科技成果市场化为核心，为企业提供快速精准的需求匹配服务，从而实现企业以及科技资源的有效对接，帮助企业实现产业技术升级，助力先进技术完成产业化发展。" />
    <meta name="keywords" content="庖丁众包、智能技术、机械制造、健康医疗、材料科学、能源环保、生产流程优化"/>
    <meta name='viewport' content='user-scalable=no,width=750'>
    <link rel="stylesheet" href="{$Think.MOBILE}/css/common_new.css">
    <link rel="stylesheet" href="{$Think.MOBILE}/css/activity.css">
    <link rel="stylesheet" href="{$Think.MOBILE}/css/demand.css">
    <link rel="stylesheet" href="{$Think.MOBILE}/css/swiper.css">
    <include file="./Template/5u/common/common.html" />
</head>
<body style="padding-bottom:150px;" ng-controller="detailCtrl">
    <div class="mask" style="display:none"></div>
    <div class="alert" style="display:none">
        <img src="{$Think.MOBILE}/images/exclamation.png" alt="" style="margin-top:40px">
        <div class="sorry">
            您目前还没有登录<br>
            请先
            <a href="/index.php/Mobile/Login/login"><span class="findDemand">登录/注册</span></a>
        </div>
        <div class="close">关闭</div>
    </div>
    <div class="act_details_banner">
        <img ng-cloak ng-src="{{details.cover_url}}" alt="">
    </div>

    <div class="act_details_article">
        <p class="act_details_article_tit" ng-cloak>{{details.title}}</p>
        <p class="act_details_article_scan">
            浏览<span class="act_art_scan" ng-cloak>{{details.clicks}}</span>
            收藏<span class="act_art_collect" ng-cloak>{{details.shoucang}}</span>
        </p>
    </div>

    <div class="act_details_head">
        <div class="act_details_head_section clear">
            <div class="act_details_icon icon_time fl"></div>
            <div class="act_details_head_ct fr">
                <p class="act_section_ct" ng-cloak>
                    {{details.formal_start_time}}
                </p>
            </div>
        </div>

        <div class="act_details_head_section clear">
            <div class="act_details_icon icon_address fl"></div>
            <div class="act_details_head_ct fr">
                <p class="act_section_ct" ng-cloak>
                    {{details.address}}
                </p>
            </div>
        </div>

        <div class="act_details_head_section clear">
            <div class="act_details_icon icon_price fl"></div>
            <div class="act_details_head_ct fr">
                <p class="act_section_ct" ng-cloak>{{details.cost}}</p>
            </div>
        </div>
    </div>

    <div class="act_details_main">
        <div class="act_details_main_section clear">
            <div class="act_details_icon icon_conference fl"></div>
            <p class="act_section_tit fl">会议目的</p>
        </div>
        <p class="act_details_main_ct" ng-cloak>{{details.desc}}</p>
    </div>

    <div class="act_details_main">
        <div class="act_details_main_section clear">
            <div class="act_details_icon icon_conference fl"></div>
            <p class="act_section_tit fl">会议内容</p>
        </div>
        <p class="act_details_main_ct" ng-cloak>
            {{details.hynr}}
        </p>
    </div>

    <div class="act_details_main">
        <div class="act_details_main_section clear">
            <div class="act_details_icon icon_conference fl"></div>
            <p class="act_section_tit fl">参会嘉宾</p>
        </div>
        <img class="act_main_pic" ng-cloak ng-src="{{details.chjb}}" alt="">
    </div>

    <div class="act_details_main">
        <div class="act_details_main_section clear">
            <div class="act_details_icon icon_conference fl"></div>
            <p class="act_section_tit fl">会议流程</p>
        </div>
        <img class="act_main_pic" ng-cloak ng-src="{{details.hylc}}" alt="">
    </div>

    <div class="act_details_main">
        <div class="act_details_main_section clear">
            <div class="act_details_icon icon_conference fl"></div>
            <p class="act_section_tit fl">组织形式</p>
        </div>
        <img class="act_main_pic" ng-cloak ng-src="{{details.zzxs}}" alt="">
    </div>

    <div class="sec_return">
        <a onclick="goBack();">
            <img class="return_icon" src="{$Think.MOBILE}/images/icon-common-return.png" alt="">
        </a>
        <img class="act_love_icon" src="{$Think.MOBILE}/images/icon-activity-collect-default.png" alt="">
        <a class="act_det_btn" id="act_det_btn" ng-show="details.status=='1'">
            立即报名
        </a>
        <a class="act_det_btn" style="background:#999;" ng-show="details.status=='0'">
            活动已结束
        </a>
    </div>
</body>
<script src='{$Think.MOBILE}/js/jquery-3.0.0.min.js'></script>
<script src="{$Think.MOBILE}/js/angular.min.js"></script>
<script>
    var action = 0;
    var data_id = GetQueryString('data_id');  

    var app = angular.module("detail",[]);
    app.controller("detailCtrl",function ($scope,$http){
        $http({
            method:"GET",
            params:{data_id:data_id},
            url:"/api.php/ChannelIndex/index/action/dataDetail/channel/hd/type/1/"
        }).then(function successCallback(response) {                      
                $scope.details = response.data.data;     
                 var startTime = $scope.details.formal_start_time;
                 if(Date.parse(new Date()) > Date.parse(startTime)){   
                    $scope.details['status']="0";//已结束
                }else{
                    $scope.details['status']="1";//未举办
                }
            }, function errorCallback(response) {
            });

        // 判断本技术是否已经收藏
        $http({
            method:'GET',
            params:{data_id:data_id,channel:'hd'},
            url:'/index.php/Mobile/Article/is_like'
        }).then(function successCallback(response) {
                // console.log(response.data.msg);            
                if (response.data.msg == "未收藏") {                 
                     $(".act_love_icon").attr("src","{$Think.MOBILE}/images/icon-activity-collect-default.png");
                     action = '1';

                } else {
                     $(".act_love_icon").attr("src","{$Think.MOBILE}/images/icon-activity-collect-active.png");
                     action = '0';
                }
            }, function errorCallback(response) {                   
            });

        // 立即报名
        $("#act_det_btn").on("click",function(){
             //判断是否登录             
            $http({
                method:'GET',                
                url:'/api.php/user/check_login'
            }).then(function successCallback(response) {                     
                if(response.data.code=="400" || response.data.result==0){
                    $(".mask").show();
                    $(".alert").show();
                    return false;               
                } else {
                     // 判断是否绑定手机号
                     $http({
                         method:'GET',                
                         url:'/api.php/user/check_phone'
                     }).then(function successCallback(response) {                  
                         // 已经绑定
                         if(response.data.result==1){      
                            window.location.href = 'http://www.paoding.cc/index.php/Mobile/Activity/enter';
                         // 没有绑定
                         }else{
                             window.location.href="/index.php/Mobile/User/binding.html";
                         }
                     })
                }
            }, function errorCallback(response) {});
         });
        // 收藏/取消收藏
        $(".act_love_icon").on("click",function(){
            $http({
                method:'GET',                
                url:'/index.php/Mobile/Activity/like?hd_id='+data_id+'&action='+action
            }).then(function successCallback(response) {              
                  if (response.data.code=="402"){                    
                       $(".mask").show();
                       $(".alert").show();
                        return false;
                  } else {
                       // 如果未收藏
                        if (action == 0) {                            
                            $(".act_love_icon").attr("src","{$Think.MOBILE}/images/icon-activity-collect-default.png");                            
                        } else {
                             $(".act_love_icon").attr("src","{$Think.MOBILE}/images/icon-activity-collect-active.png");                             
                        };

                  }
                }, function errorCallback(response) {
                    console.log(response.data.msg);                   
                });
            });
        });

        $(".findDemand").on("click",function(){
            $(".sorry").hide();
            $(".showTel").show();
        });
        // 关闭弹出框
        $(".close").on("click",function(){
            $(".mask").hide();
            $(".alert").hide();
        });
        $(".mask").on("click",function(){
            $(".mask").hide();
            $(".alert").hide();
        });

        function goBack(){
            window.location.href='/index.php/Mobile/Activity/activity';
        };
        
</script>
</html>