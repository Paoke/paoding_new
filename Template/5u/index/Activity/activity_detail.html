<!doctype html>
<html lang="en" ng-app="detail">
<head>
    <meta charset="UTF-8">
    <title>庖丁技术</title>
    <meta name="description" content="庖丁科技众包服务平台携手国内外先进技术科研院所、顶级技术专家，以实现科技成果市场化为核心，为企业提供快速精准的需求匹配服务，从而实现企业以及科技资源的有效对接，帮助企业实现产业技术升级，助力先进技术完成产业化发展。" />
    <meta name="keywords" content="庖丁众包、智能技术、机械制造、健康医疗、材料科学、能源环保、生产流程优化"/>
    <link rel="shortcut icon" href="{$Think.INDEX}/images/favicon.ico">
    <link rel="preload" href="{$Think.INDEX}/css/index.css" as="style">
    <link rel="stylesheet" href="{$Think.INDEX}/css/common_new.css">
    <link rel="stylesheet" href="{$Think.INDEX}/css/index.css">
    <!--<include file="./Template/5u/common/common.html" />   上线开启-百度统计-->
</head>
<body ng-controller="detailCtrl" ng-cloak>
<!-- 导航开始 -->
<include file="./Template/5u/index/public/nav.html" />
<div class="section clear" style="padding-bottom:30px;">
    <div class="fl">
        <img class="tec_left_img" ng-src="{{details.cover_url}}" alt="">
    </div>
    <div class="tec_info fl" style="height:280px;">
        <div class="operate" style="bottom:28px;">
            浏览&nbsp;&nbsp;<span class="act_det_click">{{details.clicks}}</span>
            <img id="collect" class="operate_ml" src="{$Think.INDEX}/images/icon-collect.png" alt="" ng-show="status == 1">
            <img id="cancle" class="operate_ml" src="{$Think.INDEX}/images/icon-collect2.png" alt="" ng-show="status == 0">
           <div class="bdsharebuttonbox fr">
               <img class="iconwc" src="{$Think.INDEX}/images/icon-wechat.png" alt="">
               <a class="bds_weixin" data-cmd="weixin"></a>
            </div>
        </div>
        <p class="tec_title">{{details.title}}</p>
        <div class="clear">
            <p class="active_det clear">
                <img class="active_det_icon fl" src="{$Think.INDEX}/images/activity--icon-time.png" alt="">
                <span class="active_det_span"> {{details.formal_start_time | formatDate}} — {{details.formal_end_time | formatDate2}}</span>
            </p>
            <p class="active_det clear">
                <img class="active_det_icon fl" src="{$Think.INDEX}/images/activity-icon-location.png" alt="">
                <span class="active_det_span fl">{{details.address}}</span>
            </p>
            <p class="active_det clear">
                <img class="active_det_icon fl" src="{$Think.INDEX}/images/activity-icon-price.png" alt="">
                <span class="active_det_span fl">{{details.cost}}</span>
            </p>
        </div>
        <a id="at_btn" ng-show="btnStatus==1"><div class="act_apply">我要报名</div></a>
        <a ng-show="btnStatus==2"><div class="act_apply">已报名</div></a>
        <a ng-show="btnStatus==0"><div class="act_apply">活动已结束</div></a>
    </div>
</div>

<div class="act_det clear">
    <div class="act_det_left fl">
        <div class="recommend_tec">
            <span>推荐活动</span>
            <div class="div2"></div>
        </div>

        <div class="act_det_part">
            <p class="clear act_det_part_p">
                <img class="fl mt" src="{$Think.INDEX}/images/icon-title-hdxq.png" alt="">
                <span class="fl act_det_part_span">会议目的</span>
            </p>
            <div class="act_ct">{{details.desc}}</div>
        </div>

        <div class="act_det_part">
            <p class="clear act_det_part_p">
                <img class="fl mt" src="{$Think.INDEX}/images/icon-title-hdxq.png" alt="">
                <span class="fl act_det_part_span">会议内容</span>
            </p>
            <div class="act_ct">{{details.hynr}}</div>
        </div>

        <div class="act_det_part">
            <p class="clear act_det_part_p">
                <img class="fl mt" src="{$Think.INDEX}/images/icon-title-hdxq.png" alt="">
                <span class="fl act_det_part_span">会议嘉宾</span>
            </p>
            <div class="act_ct"><img class="act_main_pic" ng-cloak ng-src="{{details.chjb}}" alt=""></div>
        </div>

        <div class="act_det_part">
            <p class="clear act_det_part_p">
                <img class="fl mt" src="{$Think.INDEX}/images/icon-title-hdxq.png" alt="">
                <span class="fl act_det_part_span">会议流程</span>
            </p>
            <div class="act_ct"><img class="act_main_pic" ng-cloak ng-src="{{details.hylc}}" alt=""></div>
        </div>

        <div class="act_det_part">
            <p class="clear act_det_part_p">
                <img class="fl mt" src="{$Think.INDEX}/images/icon-title-hdxq.png" alt="">
                <span class="fl act_det_part_span">组织形式</span>
            </p>
            <div class="act_ct"><img class="act_main_pic" ng-cloak ng-src="{{details.zzxs}}" alt=""></div>
        </div>

<!--         <div class="act_det_inp">
            <textarea class="act_det_text"></textarea>
        </div>
        <p class="inp_submit">提交</p> -->
    </div>


    <div class="fl">
        <div class="main_right mr">
            <div class="recommend_tec">
                <span>推荐活动</span>
                <div class="div2"></div>
            </div>

            <div class="main_r_section" ng-repeat="tecList in tecLists">
                <img class="tec_right_pic" ng-src="{{tecList.cover_url}}" alt="">
                <p class="tec_tit_p">{{tecList.title}}</p>
                <p class="tec_time_p">发布于：<span>{{tecList.create_time | formatDate}}</span></p>
            </div>

        </div>
    </div>

</div>
<include file="./Template/5u/index/public/footer.html" />
</body>
<script src="{$Think.INDEX}/js/jquery-3.0.0.min.js"></script>
<script src="{$Think.INDEX}/js/common.js"></script>
<script src="{$Think.MOBILE}/js/angular.min.js"></script>
<script>
    var data_id = GetQueryString('data_id');

    var app = angular.module("detail",[]);
    app.filter('formatDate',function(){
        return function(date){
            return date = date.substr(0,16);
        };
    });

    app.filter('formatDate2',function(){
        return function(date){
            return date = date.substring(16,10);
        };
    });
    app.controller("detailCtrl",function ($scope,$http) {
        // 判断本技术是否已经收藏
        $http({
            method:'GET',
            params:{data_id:data_id,channel:'hd'},
            url:'/index.php/Mobile/Article/is_like'
        }).then(function successCallback(response) {                
                if(response.data.msg == "已收藏"){
                    $scope.status = 0; 
                }else{
                    $scope.status = 1; 
                }
            }, function errorCallback(response) {                   
            });

            // 收藏
            $("#collect").on("click",function(){
                $http({
                    method:'GET',                
                    url:'/index.php/Mobile/Activity/like?hd_id='+data_id+'&action=1'
                }).then(function successCallback(response) {  
                      if(response.data.code=="402"){
                         $(".login_boxs").show();
                         $(".mask").show();
                      } else {
                            $scope.status = 0;    
                        }                                  
                    }, function errorCallback(response) {                   
                    });
            });

            // 取消收藏
            $("#cancle").on("click",function(){
                $http({
                    method:'GET',                
                    url:'/index.php/Mobile/Activity/like?hd_id='+data_id+'&action=0'
                }).then(function successCallback(response) {                   
                    if(response.data.code=="402"){
                        alert("请先登录");
                        window.location.href = "/index.php/Index/Login/login";
                    } else {
                          $scope.status = 1;    
                    }
                }, function errorCallback(response) {                   
                    });
            });

            // 立即报名
            $("#at_btn").on("click",function(){
                 //判断是否登录             
                $http({
                    method:'GET',                
                    url:'/api.php/user/check_login'
                }).then(function successCallback(response) {                     
                    if(response.data.code=="400" || response.data.result==0){
                        alert("请先登录");
                        window.location.href = "/index.php/Index/Login/login";
                    } else {
                         // 判断是否绑定手机号
                         $http({
                             method:'GET',                
                             url:'/api.php/user/check_phone'
                         }).then(function successCallback(response) {            
                             // 已经绑定
                             if(response.data.result==1){      
                                window.location.href = '/index.php/Index/Activity/activity_release.html?data_id='+data_id;
                             // 没有绑定
                             }else{
                                // 跳转到绑定手机号页面
                                 // window.location.href="/index.php/Mobile/User/binding.html";
                             }
                         })
                    }
                }, function errorCallback(response) {});
             });



        $http({
            method: "GET",
            params: {data_id: data_id},
            url: "/api.php/ChannelIndex/index/action/dataDetail/channel/hd/type/1/"
        }).then(function successCallback(response) {
            $scope.details = response.data.data;
            var startTime = $scope.details.formal_start_time;
            var changeTime = startTime.replace(/-/g, '/');
            if (Date.parse(new Date()) > Date.parse(changeTime)) {
                $scope.btnStatus = 0;//已结束
                // $scope.details['status']="0";//已结束
            } else {
                $scope.btnStatus = 1;//未举办
                // $scope.details['status']="1";//未举办
            }
            // 判断活动是否已经结束
            if( $scope.btnStatus == 1 ){
                // 判断是否已经报名
                $http({
                    method:'GET',
                    params:{data_id:data_id},
                    url:'/index.php/Mobile/Activity/check_enter'
                }).then(function successCallback(response) {
                    if (response.data.result == "1") {  //已报名
                        $scope.btnStatus = 2;
                    } else {
                        $scope.btnStatus = 1;
                    }
                }, function errorCallback(response) {
                });
            }
        }, function errorCallback(response) {
        });



        //推荐活动
        var data = {
            page:1,
            page_num:5,
            order_field:'create_time',
            category_id:0,
            tag_id:0,
            order_by:'DESC'
        };
        $http({
            method:"POST",
            data:data,
            url:"/api.php/ChannelIndex/index/action/dataList/channel/hd/type/1",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            transformRequest: function(obj) {
                var str = [];
                for (var p in obj) {
                    str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                }
                return str.join("&");
            }
        }).then(function successCallback(response) {
            $scope.tecLists = response.data.data;
        }, function errorCallback(response) {

        });
    });
</script>
</html>