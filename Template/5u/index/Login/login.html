<!doctype html>
<html lang="en" ng-app="login">
<head>
    <meta charset="UTF-8">
    <title>庖丁技术</title>
    <meta name="description" content="庖丁科技众包服务平台携手国内外先进技术科研院所、顶级技术专家，以实现科技成果市场化为核心，为企业提供快速精准的需求匹配服务，从而实现企业以及科技资源的有效对接，帮助企业实现产业技术升级，助力先进技术完成产业化发展。" />
    <meta name="keywords" content="庖丁众包、智能技术、机械制造、健康医疗、材料科学、能源环保、生产流程优化"/>
    <link rel="preload" href="{$Think.INDEX}/css/index.css" as="style">
    <link rel="stylesheet" href="{$Think.INDEX}/css/common_new.css">
    <link rel="stylesheet" href="{$Think.INDEX}/css/index.css">
    <link rel="stylesheet" href="{$Think.INDEX}/css/swiper.css">
    <include file="./Template/5u/common/common.html" />
</head>
</head>
<body class="login_bg" ng-controller="myLogin">
<!-- 导航开始 -->
<include file="./Template/5u/index/public/nav.html"/>

<div class="login_box" style="height:354px;">
    <div class="clear">
        <a href="__MODULE__/Register/register.html">
            <p class="log_top fl">
                注册
            </p>
        </a>
        <a href="login.html">
            <p class="log_top log_select fl">
                登&nbsp;录
            </p>
        </a>
    </div>

    <form id="formID">
        <div class="clear">
        <div class="code_div fl">
            <img class="code_pic" src="{$Think.INDEX}/images/login-wechat.png" alt="">
            <p class="wechat_login" onclick="WeChatLogin();">微信登录</p>
        </div>

        <div class="login_part fl">
            <p class="or">或</p>
            <input class="log_input" type="text" placeholder="手机" id="mobile" name="mobile">

            <input class="log_input mar_t" type="password" placeholder="密码" id="password" name="password">

            <div class="login_bottom clear">
                <div class="fl regist_tip_icon1"></div>
                <p class="fl agree_tip2"><span>手机或密码错误</span></p>
                <p class="fr forget_psw">忘记密码</p>
            </div>

            <div class="login_btn">登&nbsp;录</div>
        </div>
    </div>
    </form>
</div>
</body>
<script src="{$Think.INDEX}/js/jquery-3.0.0.min.js"></script>
<script src='{$Think.MOBILE}/js/angular.min.js'></script>
<script>


    var app = angular.module('login', []);
    app.controller('myLogin', function ($scope,$http) {
        $(".login_btn").on("click",function() {
            var mobile = $("#mobile").val();
            var password=$("#password").val();
            var data={'mobile':mobile,'password':password};
            $http({
                method: 'POST',
                data: data,
                url: '/api.php/User/login',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                transformRequest: function (obj) {
                    var str = [];
                    for (var p in obj) {
                        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                    }
                    return str.join("&");
                }
            }).then(function successCallback(response) {
                if (response.data.result == 1) {
                    tip_ct = "登录成功";
                    tip_url = '/index.php/Index/index/index.html';
                    tips.addtips(tip_ct, tip_url);
                } else {
                    tip_ct = "登录失败";
                    tips.addtips(tip_ct);
                }

            }, function errorCallback(response) {

            });
        });
    });

    function  WeChatLogin() {
        var url = "/api.php/User/getAppIdData";
        $.get(url, function (res) {
            if(res.result == 1) {
                window.location.href="https://open.weixin.qq.com/connect/qrconnect?appid="+res.data['appid']+"&redirect_uri=http://"+res.data['area_name']+"/__MODULE__/Index/index/ifWeChatLogin/1&response_type=code&scope=snsapi_login&state=2015#wechat_redirect";
            } else {
                layer.msg("系统繁忙请稍后再试！");
            }
        });
    }

</script>
</html>