<!doctype html>
<html lang="en" ng-app="detail_tec">
<head>
    <meta charset="UTF-8">
    <title>庖丁技术</title>
    <meta name="description" content="庖丁科技众包服务平台携手国内外先进技术科研院所、顶级技术专家，以实现科技成果市场化为核心，为企业提供快速精准的需求匹配服务，从而实现企业以及科技资源的有效对接，帮助企业实现产业技术升级，助力先进技术完成产业化发展。" />
    <meta name="keywords" content="庖丁众包、智能技术、机械制造、健康医疗、材料科学、能源环保、生产流程优化"/>
    <link rel="shortcut icon" href="{$Think.INDEX}/images/favicon.ico">
    <link rel="preload" href="{$Think.INDEX}/css/index.css" as="style">
    <link rel="stylesheet" href="{$Think.INDEX}/css/common_new.css">
    <link rel="stylesheet" href="{$Think.INDEX}/css/index.css">   
</head>
<body ng-controller="detail_tecCtrl" ng-cloak>
<!-- 导航开始 -->
<include file="./Template/5u/index/public/nav.html" />
<!-- 导航结束 -->
<div class="section clear" style="padding-bottom:30px;">
    <div class="fl">
        <img class="tec_left_img" ng-src="{{lists.cover_url}}" alt="">
    </div>
    <div class="tec_info fl">
        <p class="number">编号：{{lists.id}}</p>
        <div class="operate">
            发布于：<span class="operate_ml" ng-cloak>{{lists.create_time | formatDate}}</span>
            浏览&nbsp;&nbsp;<span>{{lists.clicks}}</span>
            <img id="collect" class="operate_ml" src="{$Think.INDEX}/images/icon-collect.png" alt="" ng-show="status == 1">
            <img id="cancle" class="operate_ml" src="{$Think.INDEX}/images/icon-collect2.png" alt="" ng-show="status == 0">
            <div class="bdsharebuttonbox fr">
                <img class="iconwc" src="{$Think.INDEX}/images/icon-wechat.png" alt="">
                <a class="bds_weixin" data-cmd="weixin"></a>
            </div>
        </div>
        <p class="tec_title">{{lists.title}}</p>
        <div class="clear">
            <ul class="tec_detail fl">
                <li>
                    <span class="tec_way">合作方式</span>
                    <span class="tec_ans">{{lists.hzxs}}</span>
                </li>
                <li>
                    <span class="tec_way">交付形式</span>
                    <span class="tec_ans">{{lists.jfxs}}</span>
                </li>
                <li>
                    <span class="tec_way">成熟度</span>
                    <span class="tec_ans">{{lists.csd}}</span>
                </li>
                <li>
                    <span class="tec_way">应用行列</span>
                    <span class="tec_ans">{{lists.yyxy}}</span>
                </li>
                <p class="get_contack">获取联系方式</p>
                <!-- 联系方式 -->
                <div class="contack">
                    <li>
                        <span class="tec_way">联系人</span>
                        <span class="tec_ans">{{lists.lxrxm}}</span>
                    </li>
                    <li>
                        <span class="tec_way">手机号</span>
                        <span class="tec_ans">{{lists.dhhm}}</span>
                    </li>
                    <li>
                        <span class="tec_way">邮箱号</span>
                        <span class="tec_ans">{{lists.dzyx}}</span>
                    </li>
                </div>
            </ul>

            <ul class="tec_detail fl">
                <li>
                    <span class="tec_way">合作价格</span>
                    <span class="tec_ans">{{lists.hzjg}}</span>
                </li>
                <li>
                    <span class="tec_way">技术领域</span>
                    <span class="tec_ans">{{lists.lingyu}}</span>
                </li>

            </ul>
        </div>
    </div>
</div>

<!-- 列表 -->
<div class="main_wrap">
    <div class="main clear">
        <div class="fl">
            <div class="tab">
                <div class="title">
                    <a href="#tip1">
                        <li style="color:#1e1e1e">技术讲述<div class="sideDiv"></div></li>
                    </a>
                    <a href="#tip2">
                        <li>技术优势<div class="sideDiv"></div></li>
                    </a>
                    <a href="#tip3">
                        <li>效果指标<div class="sideDiv"></div></li>
                    </a>
                    <a href="#tip4">
                        <li>应用案例<div class="sideDiv"></div></li>
                    </a>
                </div>
            </div>

            <div class="main_part">
                <a name="tip1">
                    <p class="part_title">技术讲述</p>
                    <div class="main_ct" ng-bind-html="lists.content|trustHtml"></div>
                </a>

                <a name="tip2">
                    <p class="part_title">技术优势</p>
                    <div class="main_ct" ng-bind-html="lists.jsys|trustHtml"></div>
                </a>

                <a name="tip3">
                    <p class="part_title">效果指标</p>
                    <div class="main_ct" ng-bind-html="lists.xgzb|trustHtml"></div>
                </a>

                <a name="tip4">
                    <p class="part_title">应用案例</p>
                    <div class="main_ct" ng-bind-html="lists.yyal|trustHtml"></div>
                </a>
            </div>
        </div>

        <div class="fl">
            <div class="main_right">
                <div class="recommend_tec">
                    <span>推荐技术</span>
                    <div class="div2"></div>
                </div>

                <div class="main_r_section" ng-repeat="tecList in tecLists">
                    <a href="__CONTROLLER__/tec_detail.html?data_id={{tecList.id}}">
                        <img class="tec_right_pic" ng-src="{{tecList.cover_url}}" alt="">
                        <p class="tec_tit_p">{{tecList.title}}</p>
                        <p class="tec_time_p">发布于：<span>{{tecList.create_time | formatDate}}</span></p>
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- 页脚 -->
<!-- <div ng-include="../common/footer.html"></div> -->
<include file="./Template/5u/index/public/footer.html" />
</body>
<script src="{$Think.INDEX}/js/jquery-3.0.0.min.js"></script>
<script src="{$Think.INDEX}/js/common.js"></script>
<script src='{$Think.MOBILE}/js/angular.min.js'></script>
<script>
    var data_id = GetQueryString('data_id');
    var app = angular.module('detail_tec',[]);

    app.filter("trustHtml",function ($sce){
        return function(val) {
            return $sce.trustAsHtml(val);
        }
    });

    app.filter('formatDate',function(){
        return function(date){
            return date = date.substr(0,10);
        };
    });

    app.controller("detail_tecCtrl",function ($scope,$http){
        $scope.status = 1; 
        //技术详情
        $http({
            method:'GET',
            params: {data_id:data_id},
            url:'/api.php/ChannelIndex/index/action/dataDetail/channel/js/type/1'
        }).then(function successCallback(response) {
            $scope.lists = response.data.data;
        },function errorCallback(response) {
            console.log(response);
        });

        //推荐技术
        var data = {
            page:1,
            page_num:2,
            order_field:'create_time',
            category_id:0,
            tag_id:0,
            order_by:'DESC'
        };
        $http({
            method:"POST",
            data:data,
            url:"/api.php/ChannelIndex/index/action/dataList/channel/js/type/1",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            transformRequest: function(obj) {
                var str = [];
                for (var p in obj) {
                    str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                }
                return str.join("&");
            }
        }).then(function successCallback(response) {
            $scope.tecLists = response.data.data;
        }, function errorCallback(response) {

        });

        // 判断本技术是否已经收藏
        $http({
            method:'GET',
            params:{data_id:data_id,channel:'js'},
            url:'/index.php/Mobile/Article/is_like'
        }).then(function successCallback(response) {                
                if(response.data.msg == "已收藏"){
                    $scope.status = 0; 
                }else{
                    $scope.status = 1; 
                }
            }, function errorCallback(response) {                   
            });

            // 收藏
            $("#collect").on("click",function(){
                $http({
                    method:'GET',                
                    url:'/index.php/Mobile/Article/like?channel=js&id='+data_id+'&action=1'
                }).then(function successCallback(response) {  
                      if(response.data.code=="402"){
                            alert("请先登录");
                            window.location.href = "/index.php/Index/Login/login";
                      } else {
                            $scope.status = 0;    
                        }                                  
                    }, function errorCallback(response) {                   
                    });
            });
            // 取消收藏
            $("#cancle").on("click",function(){
                $http({
                    method:'GET',                
                    url:'/index.php/Mobile/Article/like?channel=js&id='+data_id+'&action=0'
                }).then(function successCallback(response) {                   
                    if(response.data.code=="402"){
                        $(".mask").show();
                        $(".alert").show();
                        return false;
                    } else {
                          $scope.status = 1;    
                    }
                }, function errorCallback(response) {                   
                    });
            });

            // 获取联系方式
            $(".get_contack").on("click",function(){
                //判断是否登录             
               $http({
                   method:'GET',                
                   url:'/api.php/user/check_login'
               }).then(function successCallback(response) {                     
                   if(response.data.code=="400" || response.data.result==0){
                        alert("请先登录");
                       window.location.href = "/index.php/Index/Login/login";              
                   } else {
                        // 判断是否绑定手机号
                        $http({
                            method:'GET',                
                            url:'/api.php/user/check_phone'
                        }).then(function successCallback(response) {                  
                            // 已经绑定
                            if(response.data.result==1){
                                getContackWay();
                            // 没有绑定
                            }else{
                                window.location.href="index.php/Index/User/user_binding.html";
                            }
                        })
                   }
               }, function errorCallback(response) {});
            });
        }); 

    function getContackWay(){
        $(".get_contack").hide();
        $(".contack").show();
    }




</script>
</html>