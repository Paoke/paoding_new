<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">

    <title>{$tpshop_config['shop_info_store_title']}</title>
    <meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}"/>
    <meta name="description" content="{$tpshop_config['shop_info_store_desc']}"/>

    <link href="{$Think.const.CSS}/style.css" rel="stylesheet">
    <link href="{$Think.const.CSS}/style-responsive.css" rel="stylesheet">

    <script src="__PUBLIC__/plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__PUBLIC__/js/myFormValidate.js"></script>
    <script src="__PUBLIC__/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="__PUBLIC__/js/layer/layer-min.js"></script><!-- 弹窗js 参考文档 http://layer.layui.com/-->
    <script src="__PUBLIC__/js/myAjax.js"></script>
    <script src="__PUBLIC__/js/common.js" type="text/javascript"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<style type="text/css">
    .ch_label{
        margin-right: 10px;
        background-color: rgb(255, 255, 0);
    }
    .ch_tags{
        width: 400px;
        min-height: 100px;
        height: 100%;
        border: 1px solid #CCC;
        padding:10px;
        margin-bottom: 10px;

    }
    .table-bordered {
     border-top: none ;
}

</style>

<body class="sticky-header">
<section>
    <div class="main-content" width="100%" style="margin:0px;">
        <section class="wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel">
                        <header class="panel-heading">
                            添加频道主题模板
                            <div class="pull-right">
                                <div class="btn-group">
                                    <empty name="info">
                                        <button type="reset" class="btn btn-default">重填</button>
                                        <button type="button" id="postbutton" class="btn btn-default "
                                                onclick="ajax_submit_form('spec_form')">提交
                                        </button>
                                    </empty>
                                    <a href="javascript:history.go(-1)" data-toggle="tooltip" title=""
                                       class="btn btn-default" data-original-title="返回">返回</a>
                                </div>
                            </div>
                        </header>
                        <!-- /.box-header -->
                        <div class="panel-body">
                            <form class="form-horizontal adminex-form" method="post" id="spec_form">
                                <input type="hidden" id="id" name="id" value="{$info.id}"/>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">选择频道模块</label>
                                    <div class="col-sm-9">
                                        <select tabindex="1" class="form-option" name="module_type" id="module_type">
                                            <volist name="mt" id="item">
                                                <option value="{$item.module_type}">{$item.type_name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">主题模板名称</label>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="模板所在文件夹路径名" class="form-control form-input large"
                                               name="theme_name" id="theme_name" datatype="*1-40" nullmsg="模板名称不得为空" value="{$info.theme_name}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">模板标题</label>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="标题" class="form-control form-input large" name="theme_title" id="theme_title" value="{$info.theme_title}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 col-sm-2 control-label">描述：</label>
                                    <div class="col-sm-9">
                                        <textarea placeholder="模板的简单描述" class="form-control form-input" rows="5" style="resize: none"
                                                  name="description" id="description">{$info.description}</textarea>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 col-sm-2 control-label">备注：</label>
                                    <div class="col-sm-9">
                                        <textarea placeholder="" class="form-control form-input" rows="5" style="resize: none"
                                                  name="remarks" id="remarks">{$info.remarks}</textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 col-sm-2 control-label">主题模板图片：</label>
                                    <div class="col-sm-9 btn-group">
                                        <input type="text" placeholder="" class=" form-control" id="image" name="image"
                                               value="{$info.image}" style="width:400px;float: left;" readonly/>
                                        <div class="col-sm-3">
                                            <input class="btn btn-info" style="float: left;" type="button" value="上传图片"
                                                   onclick="GetUploadify(1,'image','channel_template','');"/>
                                            &nbsp;&nbsp;
                                            <button class="btn btn-info " type="button" onclick="preview('image')">预览</button>
                                        </div>
                                        &nbsp;&nbsp;
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 col-sm-2 control-label">主题模板文件：</label>
                                    <div class="col-sm-9 btn-group">
                                        <input type="text" placeholder="" class=" form-control" id="file_path" name="file_path"
                                               value="{$info.file_path}" style="width:400px;float: left;" readonly/>
                                        <div class="col-sm-3">
                                            <input class="btn btn-info" style="float: left;" type="button" value="上传压缩包"
                                                   onclick="GetUploadifyFile(1,'file_path','channel_template_zip','');"/>
                                            &nbsp;&nbsp;
                                        </div>
                                        &nbsp;&nbsp;
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">是否启用</label>
                                    <div class="col-sm-9">
                                        <input type="radio" name="is_active" value="1" checked>是&nbsp;&nbsp;
                                        <input type="radio" name="is_active" value="0">否
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 col-sm-2 control-label">内容：</label>
                                    <div class="col-sm-9">
                                        <textarea name="content" id="content">{$info.content}</textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</section>
<script type="text/javascript" src="{$Think.const.JS}/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="{$Think.const.JS}/Validform_v5.3.2_min.js"></script>
<!-- Placed js at the end of the document so the pages load faster -->
<script src="{$Think.const.JS}/jquery-1.10.2.min.js"></script>
<script src="{$Think.const.JS}/jquery-ui-1.9.2.custom.min.js"></script>
<script src="{$Think.const.JS}/jquery-migrate-1.2.1.min.js"></script>
<script src="{$Think.const.JS}/bootstrap.min.js"></script>
<script src="{$Think.const.JS}/modernizr.min.js"></script>
<script src="{$Think.const.JS}/jquery.nicescroll.js"></script>
<script src="__PUBLIC__/js/layer/layer-min.js"></script>
<script src="__PUBLIC__/js/layer/layer-min.js"></script>
<!--common scripts for all pages-->
<script src="{$Think.const.JS}/scripts.js"></script>
<js file="{$Think.const.JS}/ueditor/ueditor.config.js"/>
<js file="{$Think.const.JS}/ueditor/ueditor.all.min.js"/>
<js file="{$Think.const.JS}/ueditor/lang/zh-cn/zh-cn.js"/>
<script>
    //图片预览
    function preview(id) {
        var src = "";
        if ($('#' + id).val()) {
            src = $('#' + id).val();
        } else {
            src = $('#' + id).attr("src");
        }
        var content;
        if (src == "") {
            content = '没有图片可供预览';
            layer.msg(content);
        }
        else {
            content = "<img width='300' height='300' src='" + src + "'>";
            layer.open({
                type: 1,
                title: false,
                closeBtn: false,
                area: ['300px', '300px'],
                skin: 'layui-layer-nobg', //没有背景色
                shadeClose: true,
                content: content
            });
        }
    }    //表单提交判断，id为空则URL表示添加，否则表示编辑
    function ajax_submit_form(form_id) {
        //判断id值是否存在
        var id = $("#id").val();
        var action = '';
        if (id == '') {
            //不存在，表示添加
            action = "__URL__/channelTemplate/action/add";
        } else {
            //存在，表示编辑
            action = "__URL__/channelTemplate/action/edit";
        }
        //异步提交表单数据
        $.ajax({
            type: "post",
            url: action,
            data: $('#' + form_id).serialize(),
            dataType: 'json',
            success: function (res) {
                //alert(JSON.stringify(res));
                if (res.result == 1) {
                    setTimeout(function () {
                        window.location.href = "__URL__/channelTemplate/action/page_list";
                    }, 1000);
                }

                layer.msg(res.msg);
            }
        })
    }
</script>
</body>
</html>
<script >
    $(document).ready(function () {
        var site = "{:session('site_name')}";
        initUEditor(site, 'content',{initialFrameHeight: 500});
    });

    function GetUploadifyFile(num,elementid,path,callback)
    {
        var upurl ='/index.php?m=Admin&c=Uploadify&a=uploadFile&num='+num+'&input='+elementid+'&path='+path+'&func='+callback;
        var iframe_str='<iframe frameborder="0" ';
        iframe_str=iframe_str+'id="uploadifyfile" ';
        iframe_str=iframe_str+' src='+upurl;
        iframe_str=iframe_str+' allowtransparency="true" class="uploadframe" scrolling="no"> ';
        iframe_str=iframe_str+'</iframe>';
        $("body").append(iframe_str);
        $("iframe.uploadframe").css("height",$(document).height()).css("width","100%").css("position","absolute").css("left","0px").css("top","0px").css("z-index","999999").show();
        $(window).resize(function(){
            $("iframe.uploadframe").css("height",$(document).height()).show();
        });
    }


</script>