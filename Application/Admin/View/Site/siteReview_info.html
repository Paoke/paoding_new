<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">
    <title>{$tpshop_config['shop_info_store_title']}</title>
   <meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}" />
    <meta name="description" content="{$tpshop_config['shop_info_store_desc']}" />

  <link href="{$Think.const.CSS}/style.css" rel="stylesheet">
  <link href="{$Think.const.CSS}/style-responsive.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>
<style type="text/css">
</style>

<body class="sticky-header">
<section>   
    
    <!-- main content start-->
    <div class="main-content" width="100%" style="margin:0px;">
        <!--body wrapper start-->
        <section class="wrapper">
        <!-- page start-->
        <div class="row">
        <div class="col-lg-12">
        <section class="panel">
            <header class="panel-heading">
                站点创建
                <div class="pull-right">
                <a style="margin-top:-8px" href="javascript:history.go(-1)" data-toggle="tooltip" title="" class="btn btn-default" data-original-title="返回"><i class="fa fa-reply"></i></a>
                </div>
            </header>
                <div class="panel-body ">   
                    <!--表单数据-->
                    <form class="form-horizontal adminex-form" method="post" id="siteform" action="{:U('Admin/Site/process')}" >   <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">站点名称：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="s|n" id="site_name" name="site_name" value="{$vo.site_name}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">默认域名：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="*" name="domain" value="{$vo.site_name}.gemmap.cn" >
                                <span style="color:green">默认域名为平台为客户分配的域名</span>
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">指定域名：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="e" name="domain2" value="" >
                                <span style="color:green">指定域名为客户指定的域名，指定域名需要客户将域名指向平台的IP地址</span>
                            </div>
                        </div>-->
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">公司：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="m" name="company" value="{$vo.company}" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">客户：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="m" name="user" value="{$vo.user}" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">联系方式：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="m" name="mobile" value="{$vo.mobile}" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">模板名称：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="m" name="template" value="{$template.tmpl_dir}" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">模板标题：</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control form-input" datatype="m" name="template_title" value="{$template.title}" >
                            </div>
                        </div>
                        <input type="hidden" name="template_id" value="{$template.id}">
                        <input type="hidden" name="cat_id" value="{$template.cat_id}">
                        <input type="hidden" name="record_id" value="{$vo.id}">
                        <!--<input class="Preservation" type="submit" value="保存">-->
                            </form><!--表单数据-->
                        </div>

                    </section>
                </div>                    

        </div>
        </section>
        <div id="proccess_msg" style="text-align: center; display: none">
            <span style="color:darkgreen; font-size: 25px;"><b>正在建站，请稍后...</b></span><br/>
            <img src="__PUBLIC__/images/process.gif">
        </div>
        </div>

             
    </div>
    <!-- main content end-->
</section>
<script type="text/javascript" src="{$Think.const.JS}/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="{$Think.const.JS}/Validform_v5.3.2_min.js"></script>
<script type="text/javascript">
    /*$('.adminex-form').Validform({
        tiptype:3
    });*/
</script>
<!-- Placed js at the end of the document so the pages load faster -->
<script src="{$Think.const.JS}/jquery-1.10.2.min.js"></script>
<script src="{$Think.const.JS}/jquery-ui-1.9.2.custom.min.js"></script>
<script src="{$Think.const.JS}/jquery-migrate-1.2.1.min.js"></script>
<script src="{$Think.const.JS}/bootstrap.min.js"></script>
<script src="{$Think.const.JS}/modernizr.min.js"></script>
<script src="{$Think.const.JS}/jquery.nicescroll.js"></script>
 <script src="__PUBLIC__/js/layer/layer-min.js"></script><!-- 弹窗js 参考文档 http://layer.layui.com/-->
<!--common scripts for all pages-->
<script src="{$Think.const.JS}/scripts.js"></script>
</body>
</html>
<script>
    $(function(){
        if($("#site_name").val() == ''){
            layer.msg("站点信息加载失败，不能进行建站!", {time: 2000});
            return;
        }
        $("#proccess_msg").show();
        layer.load();
        var data = $("#siteform").serialize();
        $.ajax({
            type: "POST",
            data: data,
            url: "__URL__/process",
            dataType: 'JSON',

            success: function(data){
                layer.closeAll('loading');

                if (data.result == 1){
                    $("#proccess_msg").empty();
                    $("#proccess_msg").append('<span style="color:darkgreen; font-size: 25px;"><b>新站点已生成。</b></span>');
                    $("#proccess_msg").show();
                    layer.msg(data.msg, {time: 3000});

                    setTimeout('window.location.href = "__URL__/siteList/action/page_list"', 3000);
                } else{
                    layer.msg(data.msg, {time: 3000});
                }
            }

        });

    });

</script>